CREATE TABLE Players
(
    id   INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name varchar(30) NOT NULL UNIQUE,
    CONSTRAINT name_is_not_empty CHECK (name !~ '^\s*$')
);

CREATE TABLE Matches
(
    id           INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    player1_id      INT REFERENCES Players (id) NOT NULL,
    player2_id      INT REFERENCES Players (id) NOT NULL,
    winner_id INT REFERENCES Players (id) NOT NULL,
    CONSTRAINT players_differ CHECK (player1_id != player2_id),
    CONSTRAINT one_of_the_players_won CHECK (winner_id = player1_id OR winner_id = player2_id)
);