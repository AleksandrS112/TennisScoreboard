CREATE TABLE players
(
    id   INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name varchar(30) NOT NULL UNIQUE,
    CONSTRAINT name_is_not_empty CHECK (name !~ '^\s*$')
);

CREATE TABLE matches
(
    id           INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    player1      INT REFERENCES players (id) NOT NULL,
    player2      INT REFERENCES players (id) NOT NULL,
    winner INT REFERENCES players (id) NOT NULL,
    CONSTRAINT players_differ CHECK (player1 != player2),
    CONSTRAINT one_of_the_players_won CHECK (winner = player1 OR winner = player2)
);